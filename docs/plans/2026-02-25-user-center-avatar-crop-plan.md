---
title: 用户中心页面与头像上传裁切实施计划
status: approved
created: 2026-02-25
planner: planner
source_requirement: docs/requirements/2026-02-25-user-center-avatar-crop.md
---

# 用户中心页面与头像上传裁切实施计划

## 1. 规划目标

- 将已批准需求拆解为可执行任务清单。
- 明确依赖关系与并行策略，降低实现过程阻塞。
- 形成可直接进入 `/spec` 与实现阶段的稳定输入。

## 2. 工作分解结构（WBS）

### A. 页面骨架与路由接入（P0）

- A1 新增用户中心路由与菜单入口。
- A2 搭建用户中心页面骨架（信息区、头像区、操作区）。
- A3 对接现有 UI 组件体系样式规范。

### B. 用户资料读取与保存（P0）

- B1 接入现有用户资料查询 API，完成初始化回填。
- B2 接入资料保存 API，完成可编辑字段提交流程。
- B3 补齐加载态、空态、错误态提示。

### C. 头像上传与前置校验（P0）

- C1 实现本地文件选择（头像入口）。
- C2 实现文件规则校验：仅 `png`、大小 `<=10MB`。
- C3 实现校验失败提示与流程阻断。

### D. 头像裁切与预览（P0）

- D1 接入头像裁切组件并固定比例 `1:1`。
- D2 实现裁切框交互（拖拽/缩放）。
- D3 实现裁切结果预览。

### E. 提交保存与全局同步（P0）

- E1 将裁切结果转换为提交参数并调用保存接口。
- E2 保存成功后刷新当前页头像显示。
- E3 同步更新全局用户头像（导航栏/头部等）。

### F. 质量保障与验收（P0）

- F1 为关键函数补充单测（校验、转换、异常处理）。
- F2 增加关键流程测试（正常流 + 异常流）。
- F3 执行并通过 `lint`、`test`、`build` 验收。

## 3. 任务清单（可执行版，2-5 分钟粒度）

| ID | 任务 | 优先级 | 预计耗时 | 依赖 |
|----|------|--------|----------|------|
| T01 | 新增用户中心路由配置 | P0 | 2-5 分钟 | - |
| T02 | 新增用户中心菜单入口 | P0 | 2-5 分钟 | T01 |
| T03 | 创建用户中心页面文件与基础布局 | P0 | 2-5 分钟 | T01 |
| T04 | 按现有 UI 体系接入页面基础组件 | P0 | 2-5 分钟 | T03 |
| T05 | 接入资料查询 API 并完成初始化加载 | P0 | 2-5 分钟 | T03 |
| T06 | 完成资料展示与可编辑字段绑定 | P0 | 2-5 分钟 | T05 |
| T07 | 接入资料保存 API | P0 | 2-5 分钟 | T06 |
| T08 | 实现资料保存成功/失败提示 | P0 | 2-5 分钟 | T07 |
| T09 | 实现头像文件选择入口 | P0 | 2-5 分钟 | T04 |
| T10 | 实现 `png` 格式校验 | P0 | 2-5 分钟 | T09 |
| T11 | 实现 `<=10MB` 大小校验 | P0 | 2-5 分钟 | T09 |
| T12 | 实现校验失败提示与提交流程阻断 | P0 | 2-5 分钟 | T10,T11 |
| T13 | 接入裁切组件并固定 `1:1` 比例 | P0 | 2-5 分钟 | T09 |
| T14 | 实现裁切交互（拖拽/缩放） | P0 | 2-5 分钟 | T13 |
| T15 | 实现裁切后预览区域展示 | P0 | 2-5 分钟 | T14 |
| T16 | 裁切结果转换并调用头像保存接口 | P0 | 2-5 分钟 | T15,T07 |
| T17 | 保存成功后刷新用户中心头像 | P0 | 2-5 分钟 | T16 |
| T18 | 保存成功后同步全局头像显示 | P0 | 2-5 分钟 | T16 |
| T19 | 处理上传/保存异常并提供重试入口 | P0 | 2-5 分钟 | T16 |
| T20 | 补充格式/大小校验单测 | P0 | 2-5 分钟 | T10,T11,T12 |
| T21 | 补充裁切结果转换单测 | P0 | 2-5 分钟 | T16 |
| T22 | 补充关键流程测试（选择-裁切-保存） | P0 | 2-5 分钟 | T17,T19 |
| T23 | 执行 `lint` 并修复问题 | P0 | 2-5 分钟 | T22 |
| T24 | 执行 `test` 并修复问题 | P0 | 2-5 分钟 | T22 |
| T25 | 执行 `build` 并完成总体验收 | P0 | 2-5 分钟 | T23,T24 |

## 4. 依赖关系与并行策略

### 主依赖链（关键路径）

`T01 -> T03 -> T05 -> T06 -> T07 -> T09 -> T13 -> T14 -> T15 -> T16 -> T17/T18 -> T22 -> T23/T24 -> T25`

### 可并行任务

- 页面与资料：`T04` 可与 `T05` 并行。
- 文件规则：`T10` 与 `T11` 可并行，随后合并到 `T12`。
- 结果同步：`T17` 与 `T18` 可并行。
- 测试执行：`T23` 与 `T24` 在 `T22` 后可并行推进。

## 5. 里程碑与交付物

- M1（页面可达）：完成 `T01-T04`，用户中心可访问且样式对齐。
- M2（资料可用）：完成 `T05-T08`，资料可加载与保存。
- M3（头像闭环）：完成 `T09-T19`，上传/裁切/预览/保存全流程打通。
- M4（可验收）：完成 `T20-T25`，质量检查通过并可交付。

## 6. 风险与缓解措施

| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| 裁切组件与现有 UI 风格不一致 | 体验割裂 | 优先复用现有弹窗/表单组件，仅替换核心裁切能力 |
| 前后端文件规则不一致 | 上传失败率升高 | 以 `png`、`<=10MB`、`1:1` 为统一规则，联调前再次对齐 |
| 头像保存后全局状态未同步 | 用户感知“未生效” | 使用统一用户状态源，保存成功后单点刷新全局头像 |
| 异常分支覆盖不足 | 线上失败难恢复 | 必须覆盖校验失败、接口失败、超时三类重试路径 |

## 7. Gate 2 检查清单

- [x] 任务已拆解到 2-5 分钟粒度。
- [x] 关键依赖与可并行关系已标注。
- [x] 主要风险已识别并给出缓解措施。
- [x] 与需求文档范围一致，无超范围项。

## 8. 下一阶段建议

- 该需求属于中等复杂度前端业务改造，可直接进入 `/spec` 产出技术规格。
- 建议命令：`/spec @docs/plans/2026-02-25-user-center-avatar-crop-plan.md`
